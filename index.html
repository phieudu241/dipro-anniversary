<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K·ª∑ Ni·ªám 3 NƒÉm L√†m Vi·ªác T·∫°i Dipro</title>
    <!-- Tailwind CSS via jsdelivr -->
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.22.0/firebase-app-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/firebase@9.22.0/firebase-database-compat.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <style>
        .result-bar {
            height: 20px;
            background-color: #3b82f6;
            border-radius: 4px;
            margin-top: 5px;
            transition: width 0.5s ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        .audio-container {
            background: linear-gradient(135deg, #e6f2ff 0%, #f0f8ff 100%);
        }
        .content-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <div class="content-gradient shadow-lg rounded-lg p-6 md:p-8">
            <!-- Header Section -->
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-blue-600 mb-4">üéâ K·ª∂ NI·ªÜM 3 NƒÇM L√ÄM VI·ªÜC T·∫†I DIPRO ‚Äì TEAM TOKI M√ÉI ƒê·ªàNH! üéâ</h1>
                <div class="w-16 h-1 bg-blue-500 mx-auto mb-6"></div>
            </div>
            
            <!-- Content Section -->
            <div class="mb-8 text-gray-700 leading-relaxed">
                <p class="mb-4">H√¥m nay ƒë√°nh d·∫•u tr√≤n 3 nƒÉm m√¨nh g·∫Øn b√≥ c√πng Dipro ‚Äì m·ªôt h√†nh tr√¨nh kh√¥ng qu√° d√†i, nh∆∞ng ƒë·ªß ƒë·ªÉ ch·ª©a ƒë·ª±ng bi·∫øt bao k·ª∑ ni·ªám, c·∫£m x√∫c v√† s·ª± tr∆∞·ªüng th√†nh.</p>
                
                <p class="mb-4">T·ª´ nh·ªØng ng√†y ƒë·∫ßu c√≤n b·ª° ng·ª°, ƒë·∫øn hi·ªán t·∫°i khi nh√¨n l·∫°i, m√¨nh th·∫≠t s·ª± bi·∫øt ∆°n v√¨ ƒë√£ ƒë∆∞·ª£c l√† m·ªôt ph·∫ßn c·ªßa team Toki ‚Äì m·ªôt team kh√¥ng ch·ªâ <span class="text-blue-600 font-semibold">"m√£i ƒë·ªânh"</span> v·ªÅ nƒÉng l·ª±c, m√† c√≤n <span class="text-blue-600 font-semibold">"ƒë·ªânh c·ªßa ch√≥p"</span> v·ªÅ t√¨nh c·∫£m ƒë·ªìng ƒë·ªôi. ü´∂</p>
                
                <p class="mb-4">·ªû ƒë√¢y, m√¨nh c√≥ nh·ªØng ng∆∞·ªùi em, nh·ªØng ƒë·ªìng nghi·ªáp, m√† th·ª±c s·ª± l√† nh·ªØng ng∆∞·ªùi b·∫°n tuy·ªát v·ªùi. Ch√∫ng ta ƒë√£ c√πng nhau v∆∞·ª£t qua bi·∫øt bao deadline g·∫•p, nh·ªØng bu·ªïi OT kh√¥ng h·∫πn tr∆∞·ªõc, nh·ªØng l·∫ßn tri·ªÉn khai h·ªìi h·ªôp, nh∆∞ng c≈©ng kh√¥ng thi·∫øu nh·ªØng tr·∫≠n c∆∞·ªùi nghi√™ng ng·∫£, nh·ªØng l·∫ßn ƒÉn ch∆°i h·∫øt m√¨nh, v√† c·∫£ nh·ªØng ph√∫t gi√¢y l·∫∑ng l·∫Ω h·ªó tr·ª£ nhau ph√≠a sau.</p>
                
                <p class="mb-4">Ba nƒÉm kh√¥ng ch·ªâ l√† c·ªôt m·ªëc th·ªùi gian, m√† c√≤n l√† m·ªôt d·∫•u ·∫•n c·ªßa s·ª± c·ªë g·∫Øng, h·ªçc h·ªèi v√† g·∫Øn b√≥. M√¨nh ƒë√£ h·ªçc ƒë∆∞·ª£c r·∫•t nhi·ªÅu, kh√¥ng ch·ªâ v·ªÅ c√¥ng vi·ªác m√† c√≤n v·ªÅ c√°ch l√†m vi·ªác nh√≥m, c√°ch s·∫ª chia, v√† nh·∫•t l√† c√°ch tr·ªü th√†nh phi√™n b·∫£n t·ªët h∆°n c·ªßa ch√≠nh m√¨nh.</p>
                
                <p class="mb-4">C·∫£m ∆°n Dipro ƒë√£ lu√¥n l√† m·ªôt m√¥i tr∆∞·ªùng tuy·ªát v·ªùi ƒë·ªÉ m√¨nh ph√°t tri·ªÉn.<br>
                C·∫£m ∆°n team Toki v√¨ ƒë√£ lu√¥n "ch∆°i h·∫øt m√¨nh, l√†m h·∫øt s·ª©c", ƒë·ªìng h√†nh c√πng nhau qua bao thƒÉng tr·∫ßm.</p>
                
                <p class="mb-4">üíô Mong r·∫±ng ch·∫∑ng ƒë∆∞·ªùng ph√≠a tr∆∞·ªõc, m√¨nh v√† m·ªçi ng∆∞·ªùi v·∫´n s·∫Ω ti·∫øp t·ª•c c√πng nhau t·∫°o n√™n nhi·ªÅu ƒëi·ªÅu tuy·ªát v·ªùi h∆°n n·ªØa!</p>
                
                <div class="text-blue-600 font-bold mt-6">
                    #Dipro #TeamTokiM√£iƒê·ªânh #3YearsAnniversary #GratefulJourney #WeAreOne
                </div>
            </div>
            
            <!-- Audio Player Section -->
            <div class="audio-container rounded-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-blue-700 mb-4">Nh·ªØng b√†i h√°t k·ª∑ ni·ªám</h2>
                <p class="mb-6 text-gray-600">B√¨nh ch·ªçn b√†i h√°t y√™u th√≠ch c·ªßa b·∫°n b√™n d∆∞·ªõi! B·∫°n c√≥ th·ªÉ b√¨nh ch·ªçn nhi·ªÅu b√†i.</p>
                
                <div class="mb-4">
                    <div id="loading" class="text-center text-blue-600 italic mb-6">
                        <i class="fas fa-spinner fa-spin mr-2"></i> ƒêang t·∫£i d·ªØ li·ªáu b√¨nh ch·ªçn...
                    </div>
                    
                    <div class="mb-4">
                        <input type="text" id="voterName" placeholder="T√™n c·ªßa b·∫°n (t√πy ch·ªçn)" 
                            class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 w-full md:w-64">
                    </div>
                </div>
                
                <!-- Song 1 -->
                <div class="mb-8 p-4 bg-white rounded-lg shadow-sm" id="song1">
                    <div class="font-bold text-blue-700 mb-2">B√†i h√°t 1</div>
                    <audio controls class="w-full mb-3">
                        <source src="audio/song1.mp3" type="audio/mpeg">
                        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t nh·∫°c.
                    </audio>
                    <div class="flex items-center">
                        <button class="vote-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md mr-3 transition duration-200 flex items-center" data-song="1">
                            <i class="fas fa-heart mr-2"></i> B√¨nh ch·ªçn
                        </button>
                        <div class="vote-count font-bold text-blue-600"><span id="vote-count-1">0</span> <i class="fas fa-thumbs-up ml-1"></i></div>
                        <div class="thank-you hidden ml-3 text-green-600"><i class="fas fa-check-circle mr-1"></i> ƒê√£ b√¨nh ch·ªçn!</div>
                    </div>
                </div>
                
                <!-- Song 2 -->
                <div class="mb-8 p-4 bg-white rounded-lg shadow-sm" id="song2">
                    <div class="font-bold text-blue-700 mb-2">B√†i h√°t 2</div>
                    <audio controls class="w-full mb-3">
                        <source src="audio/song2.mp3" type="audio/mpeg">
                        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t nh·∫°c.
                    </audio>
                    <div class="flex items-center">
                        <button class="vote-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md mr-3 transition duration-200 flex items-center" data-song="2">
                            <i class="fas fa-heart mr-2"></i> B√¨nh ch·ªçn
                        </button>
                        <div class="vote-count font-bold text-blue-600"><span id="vote-count-2">0</span> <i class="fas fa-thumbs-up ml-1"></i></div>
                        <div class="thank-you hidden ml-3 text-green-600"><i class="fas fa-check-circle mr-1"></i> ƒê√£ b√¨nh ch·ªçn!</div>
                    </div>
                </div>
                
                <!-- Song 3 -->
                <div class="mb-8 p-4 bg-white rounded-lg shadow-sm" id="song3">
                    <div class="font-bold text-blue-700 mb-2">B√†i h√°t 3</div>
                    <audio controls class="w-full mb-3">
                        <source src="audio/song3.mp3" type="audio/mpeg">
                        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t nh·∫°c.
                    </audio>
                    <div class="flex items-center">
                        <button class="vote-button bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md mr-3 transition duration-200 flex items-center" data-song="3">
                            <i class="fas fa-heart mr-2"></i> B√¨nh ch·ªçn
                        </button>
                        <div class="vote-count font-bold text-blue-600"><span id="vote-count-3">0</span> <i class="fas fa-thumbs-up ml-1"></i></div>
                        <div class="thank-you hidden ml-3 text-green-600"><i class="fas fa-check-circle mr-1"></i> ƒê√£ b√¨nh ch·ªçn!</div>
                    </div>
                </div>
                
                <!-- Voting Results Section -->
                <div id="voting-results" class="bg-blue-50 p-5 rounded-lg mt-6">
                    <div class="font-bold text-blue-700 mb-4 text-lg">K·∫øt qu·∫£ b√¨nh ch·ªçn</div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <div>B√†i h√°t 1:</div>
                            <div><span id="result-count-1">0</span> phi·∫øu</div>
                        </div>
                        <div class="result-bar" id="result-bar-1" style="width: 0%"></div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <div>B√†i h√°t 2:</div>
                            <div><span id="result-count-2">0</span> phi·∫øu</div>
                        </div>
                        <div class="result-bar" id="result-bar-2" style="width: 0%"></div>
                    </div>
                    
                    <div class="mb-4">
                        <div class="flex justify-between mb-1">
                            <div>B√†i h√°t 3:</div>
                            <div><span id="result-count-3">0</span> phi·∫øu</div>
                        </div>
                        <div class="result-bar" id="result-bar-3" style="width: 0%"></div>
                    </div>
                    
                    <div class="text-center text-gray-600 italic mt-4">
                        T·ªïng s·ªë phi·∫øu b·∫ßu: <span id="total-votes">0</span>
                    </div>
                    
                    <div class="mt-6 border-t pt-4 border-blue-200">
                        <div class="text-blue-700 font-semibold mb-2">B√¨nh ch·ªçn g·∫ßn ƒë√¢y:</div>
                        <ul id="voters-list" class="text-gray-600 text-sm"></ul>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <footer class="text-center text-gray-500 text-sm mt-8">
                <p>¬© 2025 - K·ª∑ ni·ªám 3 nƒÉm t·∫°i Dipro</p>
            </footer>
        </div>
    </div>

    <script>
        // Firebase configuration - YOU NEED TO REPLACE THIS WITH YOUR OWN FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyCLlaHjsaJXF8eeLwVmbvpfy5jfjsNvKls",
            authDomain: "dipro-anniversary.firebaseapp.com",
            databaseURL: "https://dipro-anniversary-default-rtdb.firebaseio.com",
            projectId: "dipro-anniversary",
            storageBucket: "dipro-anniversary.firebasestorage.app",
            messagingSenderId: "757623457189",
            appId: "1:757623457189:web:2ac4919a14b899064c144c"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Reference to votes in database
        const votesRef = database.ref('votes');
        const votersRef = database.ref('voters');
        
        // Generate a unique ID for this user if not already stored
        let userId = localStorage.getItem('userId') || generateUserId();
        let userVotes = JSON.parse(localStorage.getItem('userVotes') || '[]');
        let votes = {1: 0, 2: 0, 3: 0};
        
        function generateUserId() {
            const id = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            localStorage.setItem('userId', id);
            return id;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Add click event listeners to vote buttons
            document.querySelectorAll('.vote-button').forEach(button => {
                button.addEventListener('click', function() {
                    const songId = this.getAttribute('data-song');
                    vote(songId);
                });
            });
            
            // Listen for vote updates
            votesRef.on('value', (snapshot) => {
                const data = snapshot.val() || {song1: 0, song2: 0, song3: 0};
                votes = {
                    1: data.song1 || 0,
                    2: data.song2 || 0,
                    3: data.song3 || 0
                };
                
                // Update vote counts
                document.getElementById('vote-count-1').textContent = votes[1];
                document.getElementById('vote-count-2').textContent = votes[2];
                document.getElementById('vote-count-3').textContent = votes[3];
                
                // Update results
                updateResults();
                
                // Hide loading message
                document.getElementById('loading').style.display = 'none';
            });
            
            // Listen for voter updates
            votersRef.orderByChild('timestamp').limitToLast(10).on('value', (snapshot) => {
                const votersList = document.getElementById('voters-list');
                votersList.innerHTML = '';
                
                const data = snapshot.val() || {};
                const voters = Object.values(data).sort((a, b) => b.timestamp - a.timestamp);
                
                voters.forEach(voter => {
                    const li = document.createElement('li');
                    li.className = "mb-1 flex items-center";
                    const name = voter.name || '·∫®n danh';
                    const song = voter.song;
                    li.innerHTML = `<i class="fas fa-user-circle mr-1 text-blue-500"></i> ${name} ƒë√£ b√¨nh ch·ªçn cho B√†i h√°t ${song}`;
                    votersList.appendChild(li);
                });
            });
            
            // Mark already voted songs
            updateVoteButtonsState();
        });
        
        function vote(songId) {
            // Check if user has already voted for this song
            if (userVotes.includes(songId)) {
                return;
            }
            
            // Get voter name (optional)
            const voterName = document.getElementById('voterName').value.trim() || '·∫®n danh';
            
            // Update vote in database
            const updates = {};
            updates[`song${songId}`] = firebase.database.ServerValue.increment(1);
            votesRef.update(updates);
            
            // Record voter info
            const voterInfo = {
                userId: userId,
                name: voterName,
                song: songId,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };
            votersRef.push(voterInfo);
            
            // Update local storage
            userVotes.push(songId);
            localStorage.setItem('userVotes', JSON.stringify(userVotes));
            
            // Update UI
            updateVoteButtonsState();
            
            // Show thank you message with animation
            const thankYouEl = document.querySelector(`#song${songId} .thank-you`);
            thankYouEl.classList.remove('hidden');
            thankYouEl.classList.add('pulse-animation');
            
            // Add voted class to the song container
            document.getElementById(`song${songId}`).classList.add('bg-blue-50');
            document.getElementById(`song${songId}`).classList.add('border-l-4');
            document.getElementById(`song${songId}`).classList.add('border-blue-500');
        }
        
        function updateVoteButtonsState() {
            // Update all vote buttons based on user's votes
            userVotes.forEach(songId => {
                const button = document.querySelector(`.vote-button[data-song="${songId}"]`);
                const thankYouEl = document.querySelector(`#song${songId} .thank-you`);
                
                if (button) {
                    button.disabled = true;
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-gray-400', 'cursor-not-allowed');
                }
                
                if (thankYouEl) {
                    thankYouEl.classList.remove('hidden');
                }
                
                // Mark song container
                document.getElementById(`song${songId}`).classList.add('bg-blue-50');
                document.getElementById(`song${songId}`).classList.add('border-l-4');
                document.getElementById(`song${songId}`).classList.add('border-blue-500');
            });
        }
        
        function updateResults() {
            // Update result counts
            document.getElementById('result-count-1').textContent = votes[1];
            document.getElementById('result-count-2').textContent = votes[2];
            document.getElementById('result-count-3').textContent = votes[3];
            
            // Calculate total votes
            const totalVotes = votes[1] + votes[2] + votes[3];
            document.getElementById('total-votes').textContent = totalVotes;
            
            // Calculate and update percentages
            if (totalVotes > 0) {
                document.getElementById('result-bar-1').style.width = (votes[1] / totalVotes * 100) + '%';
                document.getElementById('result-bar-2').style.width = (votes[2] / totalVotes * 100) + '%';
                document.getElementById('result-bar-3').style.width = (votes[3] / totalVotes * 100) + '%';
            }
        }
    </script>
</body>
</html>